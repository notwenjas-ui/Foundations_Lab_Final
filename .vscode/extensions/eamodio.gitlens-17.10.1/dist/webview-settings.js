exports.id=426,exports.ids=[426],exports.modules={4834(e,t,n){n.d(t,{SettingsWebviewProvider:()=>SettingsWebviewProvider});var o=n(1398),i=n(9701),a=n(9554),s=n(5067),r=n(5994),c=n(8681),d=n(3995),u=n(9227),g=n(4933),h=n(4170),l=n(7775),m=n(1396),p=n(5162),f=n(3178),C=n(2126);let b="settings",v=new C.Oz(b,"configuration/preview"),w=new C.C1(b,"didOpenAnchor"),y=new C.C1(b,"didChangeAccount"),S=new C.C1(b,"didChangeIssueIntegrationConnected");var A=Object.defineProperty,H=Object.getOwnPropertyDescriptor,k=(e,t,n,o)=>{for(var i,a=o>1?void 0:o?H(t,n):t,s=e.length-1;s>=0;s--)(i=e[s])&&(a=(o?i(t,n,a):i(a))||a);return o&&a&&A(t,n,a),a};let SettingsWebviewProvider=class SettingsWebviewProvider{constructor(e,t){this.container=e,this.host=t,this._disposable=o.Disposable.from(h.H.onDidChangeAny(this.onAnyConfigurationChanged,this),e.subscription.onDidChange(this.onSubscriptionChanged,this),e.integrations.onDidChangeConnectionState(this.onIntegrationConnectionStateChanged,this))}_disposable;_pendingJumpToAnchor;dispose(){this._disposable.dispose()}getTelemetryContext(){return{...this.host.getTelemetryContext()}}onSubscriptionChanged(e){this.host.notify(y,{hasAccount:null!=e.current.account})}onIntegrationConnectionStateChanged(e){let t=e.key;(0,g.EH)(t)&&this.host.notify(S,{integrationId:t,connected:"connected"===e.reason})}async getAccountState(){return null!=(await this.container.subscription.getSubscription()).account}async getJiraConnected(){let e=await this.container.integrations.get(i.NN.Jira);return null!=e&&(e.maybeConnected??e.isConnected())}async getLinearConnected(){let e=await this.container.integrations.get(i.NN.Linear);return null!=e&&(e.maybeConnected??e.isConnected())}async includeBootstrap(e){let t=[["user","User"]];o.workspace.workspaceFolders?.length&&t.push(["workspace","Workspace"]);let[n,i]=(await Promise.allSettled([this.getJiraConnected(),this.getLinearConnected()])).map(e=>(0,m.Ro)(e,!1));return{...this.host.baseWebviewState,version:this.container.version,config:h.H.getAll(!0),customSettings:this.getCustomSettings(),scope:"user",scopes:t,hasAccount:await this.getAccountState(),hasConnectedJira:n,hasConnectedLinear:i}}onReloaded(){this.notifyDidChangeConfiguration()}onShowing(e,t,...n){let o=n[0];if(o&&"string"==typeof o){if(!e&&this.host.ready&&this.host.visible)return queueMicrotask(()=>void this.host.notify(w,{anchor:o,scrollBehavior:"smooth"})),[!0,void 0];this._pendingJumpToAnchor=o}return[!0,void 0]}onActiveChanged(e){e&&this.notifyDidChangeConfiguration()}onReady(){if(null!=this._pendingJumpToAnchor){let e=this._pendingJumpToAnchor;this._pendingJumpToAnchor=void 0,this.host.notify(w,{anchor:e,scrollBehavior:"auto"})}}async onUpdateConfiguration(e){let t,n="workspace"===e.scope?o.ConfigurationTarget.Workspace:o.ConfigurationTarget.Global;for(t in e.changes){let o=e.changes[t];if((0,f.HM)(t)){let e=this.customSettings.get(t);null!=e&&"boolean"==typeof o&&await e.update(o);continue}(0,f.YU)(t,o);let i=h.H.inspect(t);if(null!=o)if("workspace"===e.scope){if(o===i.workspaceValue)continue}else{if(o===i.globalValue&&o!==i.defaultValue)continue;o===i.defaultValue&&(o=void 0)}await h.H.update(t,o,n)}for(let t of e.removes)await h.H.update(t,void 0,n)}onGenerateConfigurationPreview(e){switch(e.type){case"commit":case"commit-uncommitted":{let t,n,o=new r.Yg(this.container,"~/code/eamodio/vscode-gitlens-demo","fe26af408293cba5b4bfd77306e1ac9ff7ccaef8",new r.M7("You","eamodio@gmail.com",new Date("2016-11-12T20:41:00.000Z")),new r.M7("You","eamodio@gmail.com",new Date("2020-11-01T06:57:21.000Z")),"commit-uncommitted"===e.type?"Uncommitted changes":"Supercharged",["3ac1d3f51d7cf5f438cc69f25f6740536ad80fef"],"commit-uncommitted"===e.type?"Uncommitted changes":"Supercharged",{files:void 0,filtered:{files:[new c.l(this.container,"~/code/eamodio/vscode-gitlens-demo","code.ts",d.NO.Modified)],pathspec:"code.ts"}},void 0,[]),i=!1;switch(e.key){case h.H.name("currentLine.format"):i=h.H.get("currentLine.pullRequests.enabled");break;case h.H.name("statusBar.format"):i=h.H.get("statusBar.pullRequests.enabled")}i&&(t=new u.B9({id:"github",name:"GitHub",domain:"github.com",icon:"github"},{id:"eamodio",name:"Eric Amodio",avatarUrl:"https://avatars1.githubusercontent.com/u/641685?s=32&v=4",url:"https://github.com/eamodio"},"1",void 0,"Supercharged","https://github.com/gitkraken/vscode-gitlens/pulls/1",{owner:"gitkraken",repo:"vscode-gitlens"},"merged",new Date("Sat, 12 Nov 2016 19:41:00 GMT"),new Date("Sat, 12 Nov 2016 19:41:00 GMT"),void 0,new Date("Sat, 12 Nov 2016 20:41:00 GMT")));try{n=s.c.fromTemplate(e.format,o,{dateFormat:h.H.get("defaultDateFormat"),pullRequest:t,messageTruncateAtNewLine:!0})}catch{n="Invalid format"}return{preview:n}}}}onAnyConfigurationChanged(e){(h.H.changedAny(e,a.Od)||h.H.changedAny(e,[...(0,l.Tj)(this.customSettings.values(),e=>e.name)]))&&this.notifyDidChangeConfiguration()}_customSettings;get customSettings(){return null==this._customSettings&&(this._customSettings=new Map([["rebaseEditor.enabled",{name:"workbench.editorAssociations",enabled:()=>this.container.rebaseEditor.enabled,update:this.container.rebaseEditor.setEnabled}],["currentLine.useUncommittedChangesFormat",{name:"currentLine.uncommittedChangesFormat",enabled:()=>null!=h.H.get("currentLine.uncommittedChangesFormat"),update:async e=>h.H.updateEffective("currentLine.uncommittedChangesFormat",e?"✏️ ${ago}":null)}]])),this._customSettings}getCustomSettings(){let e=Object.create(null);for(let[t,n]of this.customSettings)e[t]=n.enabled();return e}notifyDidChangeConfiguration(){return this.host.notify(f.HE,{config:h.H.getAll(!0),customSettings:this.getCustomSettings()})}};k([(0,p.a1)(f.lJ)],SettingsWebviewProvider.prototype,"onUpdateConfiguration",1),k([(0,p.YQ)(v)],SettingsWebviewProvider.prototype,"onGenerateConfigurationPreview",1)}};